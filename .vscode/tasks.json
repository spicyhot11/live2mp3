{
    "version": "2.0.0",
    "tasks": [
        {
            "label": "1. Conan Install (Debug)",
            "type": "shell",
            // 使用 conan install . (不带 --output-folder)，让 conanfile.txt 中的 cmake_layout 自动管理路径
            "command": "${workspaceFolder}/.venv/bin/conan install . --build=missing -s build_type=Debug",
            "options": {
                "cwd": "${workspaceFolder}/backend"
            },
            "group": "build"
        },
        {
            "label": "2. CMake Configure",
            "type": "shell",
            // 使用 Conan 生成的 preset，自动处理 toolchain 路径和构建类型
            "command": "cmake --preset conan-debug",
            "options": {
                "cwd": "${workspaceFolder}/backend"
            },
            "dependsOn": [
                "1. Conan Install (Debug)"
            ],
            "group": "build"
        },
        {
            "label": "3. Build Backend (Debug)",
            "type": "shell",
            // 构建 debug 版本，路径由 cmake_layout 决定，通常是 build/Debug
            "command": "cmake --build build/Debug",
            "options": {
                "cwd": "${workspaceFolder}/backend"
            },
            "dependsOn": [
                "2. CMake Configure"
            ],
            "group": "build"
        },
        {
            "label": "4. Setup Runtime Env",
            "type": "shell",
            // 将配置文件复制到 bin 目录，并创建 logs
            "command": "cp backend/config.json bin/ && mkdir -p bin/logs",
            "options": {
                "cwd": "${workspaceFolder}"
            },
            "dependsOn": [
                "3. Build Backend (Debug)"
            ],
            "group": "build"
        },
        {
            "label": "Build & Setup",
            "dependsOn": [
                "4. Setup Runtime Env"
            ],
            "group": {
                "kind": "build",
                "isDefault": true
            }
        }
    ]
}